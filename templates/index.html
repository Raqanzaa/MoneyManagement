<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Dashboard Keuangan (API Version)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
</head>
<body class="bg-gray-100 text-gray-800">
    <div class="container mx-auto p-4 md:p-8">
        <div class="bg-white p-6 rounded-lg shadow-md mb-6">
            <h2 class="text-2xl font-bold mb-4">Tambah Transaksi Baru</h2>
            <form id="add-transaction-form"> 
                </form>
        </div>

        <div class="bg-white rounded-lg shadow-md overflow-hidden">
            <h2 class="text-2xl font-bold p-6">Riwayat Transaksi</h2>
            <table class="min-w-full divide-y divide-gray-200">
                <thead class="bg-gray-50">
                    <tr>
                        </tr>
                </thead>
                <tbody id="transaction-table-body" class="bg-white divide-y divide-gray-200">
                    </tbody>
            </table>
        </div>
    </div>

    <script>
        const tableBody = document.getElementById('transaction-table-body');
        const form = document.getElementById('add-transaction-form');

        // Fungsi untuk mengambil data dari API dan membangun ulang tabel
        async function fetchAndRenderTransactions() {
            const response = await fetch('/api/transactions');
            const transactions = await response.json();
            
            tableBody.innerHTML = ''; // Kosongkan tabel sebelum diisi ulang

            transactions.forEach(trx => {
                const row = document.createElement('tr');
                // ... (Logika untuk membuat baris dan sel tabel dengan data trx) ...
                // Ini adalah bagian paling kompleks, di mana Anda membuat HTML dari data
                row.innerHTML = `
                    <td class="px-6 py-4 text-sm font-medium text-gray-900">${trx.deskripsi}</td>
                    <td class="px-6 py-4 text-sm">${trx.jenis === 'pemasukan' ? '<span class="px-3 py-1 text-xs font-semibold rounded-full bg-green-100 text-green-800">Pemasukan</span>' : '<span class="px-3 py-1 text-xs font-semibold rounded-full bg-red-100 text-red-800">Pengeluaran</span>'}</td>
                    <td class="px-6 py-4 text-sm text-right font-semibold ${trx.jenis === 'pemasukan' ? 'text-green-600' : 'text-red-600'}">${trx.jenis === 'pemasukan' ? '+' : '-'} Rp ${trx.jumlah.toLocaleString('id-ID')}</td>
                    <td class="px-6 py-4 text-center text-sm">
                        <button onclick="deleteTransaction(${trx.id})" class="text-red-600 hover:text-red-900 ml-4" title="Hapus"><i class="bi bi-trash3-fill"></i></button>
                    </td>
                `;
                tableBody.appendChild(row);
            });
        }

        // Fungsi untuk menghapus transaksi
        async function deleteTransaction(id) {
            if (!confirm('Apakah Anda yakin ingin menghapus transaksi ini?')) return;

            await fetch('/api/transactions/' + id, {
                method: 'DELETE',
            });
            fetchAndRenderTransactions(); // Muat ulang data setelah menghapus
        }
        
        // Event listener untuk form submission
        form.addEventListener('submit', async (event) => {
            event.preventDefault(); // Mencegah refresh halaman
            
            const formData = new FormData(form);
            const data = Object.fromEntries(formData.entries());

            await fetch('/api/transactions', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(data)
            });

            form.reset(); // Kosongkan form
            fetchAndRenderTransactions(); // Muat ulang data
        });

        // Panggil fungsi saat halaman pertama kali dimuat
        document.addEventListener('DOMContentLoaded', fetchAndRenderTransactions);
    </script>
</body>
</html>